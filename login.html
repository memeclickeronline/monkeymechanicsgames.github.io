<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meme Clicker</title>
<style>
body { font-family: Arial, sans-serif; background: #FFEB3B; margin:0; }
#topbar { display:flex; justify-content:flex-end; padding:10px; background:white; }
button { padding:5px 10px; margin-left:5px; border:none; border-radius:5px; cursor:pointer; }
#loginBtn { background:#4CAF50; color:white; }
#logoutBtn { background:#f44336; color:white; display:none; }
#loginPopup { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5); z-index:10; width:300px; text-align:center; }
input{width:100%;padding:8px;margin:5px 0;border-radius:5px;border:1px solid #ccc;box-sizing:border-box;}
#overlay { display:none; position:fixed; top:0;left:0;width:100%;height:100%; background:rgba(0,0,0,0.5); z-index:5; }
#score{font-size:24px;text-align:center;margin-top:20px;}
#clickBtn{display:block;margin:20px auto;padding:20px 40px;font-size:18px;}
</style>
</head>
<body>

<div id="topbar">
  <button id="loginBtn">Login / Sign Up</button>
  <button id="logoutBtn">Logout</button>
</div>

<div id="overlay"></div>

<div id="loginPopup">
  <h3>Sign Up</h3>
  <input type="text" id="signupUsername" placeholder="Username">
  <input type="email" id="signupEmail" placeholder="Email">
  <input type="password" id="signupPassword" placeholder="Password">
  <button onclick="signup()">Sign Up</button>
  <p id="signupMessage"></p>
  <hr>
  <h3>Login</h3>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPass" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginMessage"></p>
</div>

<h2 id="score">Aura: 0</h2>
<button id="clickBtn">Click Me!</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase setup
const firebaseConfig = {
  apiKey: "AIzaSyCF3esrFmnrLo3czErYRy1wkbRqEZfHliY",
  authDomain: "monkeymechanicsaccounts.firebaseapp.com",
  projectId: "monkeymechanicsaccounts",
  storageBucket: "monkeymechanicsaccounts.firebasestorage.app",
  messagingSenderId: "210326823006",
  appId: "1:210326823006:web:28d87c66a7d1c5a35594cf"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// UI elements
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const loginPopup = document.getElementById('loginPopup');
const overlay = document.getElementById('overlay');
loginBtn.onclick = ()=>{ loginPopup.style.display='block'; overlay.style.display='block'; }
overlay.onclick = ()=>{ loginPopup.style.display='none'; overlay.style.display='none'; }
logoutBtn.onclick = async () => {
  await auth.signOut();
  alert("Logged out!");
  logoutBtn.style.display = 'none';
  loginBtn.style.display = 'inline-block';
};

// Game variables
let clickMultiplier = 1;
let aura = 0;
const upgrades = {
  seven: { count:0, cost:1 },
  boomer: { count:0, cost:2 },
  genZ: { count:0, cost:3 },
  rizz: { count:0, cost:50 },
  skibidi: { count:0, cost:100 }
};
let bcBought = false;

const scoreEl = document.getElementById('score');
function updateScore(){ scoreEl.textContent = "Aura: "+Math.round(aura*100)/100; saveLocal(); }
function saveLocal(){
  localStorage.setItem('memeClickerProgress', JSON.stringify({aura, clickMultiplier, upgrades, bcBought}));
}
function loadLocal(){
  const p = localStorage.getItem('memeClickerProgress');
  if(p){
    const data = JSON.parse(p);
    aura = data.aura || 0;
    clickMultiplier = data.clickMultiplier || 1;
    bcBought = data.bcBought || false;
    for(const key in upgrades){
      if(data.upgrades && data.upgrades[key]) upgrades[key] = data.upgrades[key];
    }
  }
  updateScore();
}
loadLocal();

// Click button
document.getElementById("clickBtn").onclick = ()=>{ aura+=clickMultiplier; updateScore(); }

// Signup
async function signup(){
  const username = document.getElementById('signupUsername').value.trim();
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value.trim();
  const msg = document.getElementById('signupMessage');
  if(!username||!email||!password){ msg.textContent="Fill all fields"; return; }

  try{
    const uc = await auth.createUserWithEmailAndPassword(email,password);
    const user = uc.user;
    await user.sendEmailVerification();
    await db.collection('users').doc(user.uid).set({username});
    await syncProgress(user);
    msg.textContent="Sign up successful! Verify email.";
    loginBtn.style.display='none'; logoutBtn.style.display='inline-block';
  }catch(e){ msg.textContent=e.message; }
}

// Login
async function login(){
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPass').value.trim();
  const msg = document.getElementById('loginMessage');
  try{
    const uc = await auth.signInWithEmailAndPassword(email,password);
    const user = uc.user;
    if(!user.emailVerified){ msg.textContent="Verify email first!"; auth.signOut(); return; }
    await syncProgress(user);
    msg.textContent="Logged in!";
    loginPopup.style.display='none'; overlay.style.display='none';
    loginBtn.style.display='none'; logoutBtn.style.display='inline-block';
  }catch(e){ msg.textContent=e.message; }
}

// Sync local <-> Firebase
async function syncProgress(user){
  const local = localStorage.getItem('memeClickerProgress');
  const doc = await db.collection('users').doc(user.uid).get();
  if(doc.exists && doc.data().progress){
    // load Firestore
    const data = doc.data().progress;
    aura = data.aura||0;
    clickMultiplier = data.clickMultiplier||1;
    bcBought = data.bcBought||false;
    for(const key in upgrades){
      if(data.upgrades && data.upgrades[key]) upgrades[key] = data.upgrades[key];
    }
  }else if(local){
    // save local -> Firestore
    await db.collection('users').doc(user.uid).set({progress: JSON.parse(local)}, {merge:true});
  }
  updateScore();
}

// Auto-save every 5s
setInterval(async ()=>{
  const user = auth.currentUser;
  saveLocal();
  if(user) await db.collection('users').doc(user.uid).set({progress:{aura, clickMultiplier, upgrades, bcBought}}, {merge:true});
},5000);

</script>
</body>
</html>

